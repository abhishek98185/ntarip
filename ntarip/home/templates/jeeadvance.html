{% extends 'base.html' %}
{% load static %}

{% block title %}
JEE Advanced Papers
{% endblock %}

{% block extra_css %}
<style>
    #main-container {
        display: flex;
        max-width: 100vw;
        flex-wrap: wrap;
        gap: 4vw;
    }

    h1 {
        text-align: center;
    }

    .year-container {
        max-width: 600px;
        min-width: 28vw;
        margin: 20px auto;
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        gap: 4vw;


    }

    .year-header {
        background: #007bff;
        color: white;
        padding: 15px 20px;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .papers {
        justify-content: space-between;
        padding: 15px;
        background: #e9f4ff;
    }

    .paper {
        margin: 10px 0;

    }

    .options {
        display: none;
        margin-top: 10px;
        margin-left: 20px;
    }

    .button {
        background: #007bff;
        color: white;
        padding: 8px 15px;
        text-decoration: none;
        border-radius: 5px;
        margin-right: 10px;
        display: inline-block;
        transition: background 0.3s;
    }

    .button:hover {
        background: #007bff;
    }

    .toggle {
        cursor: pointer;
        color: #333;
        font-weight: bold;
        margin-top: 10px;
    }

    .arrow {
        transition: transform 0.3s;
    }

    .rotate {
        transform: rotate(90deg);
    }

    /* Animated Toggle Button Styles */
    .label {
        background-color: transparent;
        border: 2px solid #007bff;
        display: flex;
        align-items: center;
        border-radius: 50px;
        width: 140px;
        cursor: pointer;
        transition: all 0.4s ease;
        padding: 1.5px;
        position: relative;
    }

    .label::before {
        content: "";
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        background-color: #fff;
        width: 8px;
        height: 8px;
        transition: all 0.4s ease;
        border-radius: 100%;
        margin: auto;
        opacity: 0;
        visibility: hidden;
    }

    .label .input {
        display: none;
    }

    .label .title {
        font-size: 14px;
        color: #007bff;
        transition: all 0.4s ease;
        position: absolute;
        right: 18px;
        bottom: 10px;
        text-align: center;
    }

    .label .title:last-child {
        opacity: 0;
        visibility: hidden;
    }

    .label .circle {
        height: 35px;
        width: 35px;
        border-radius: 50%;
        background-color: #007bff;
        display: flex;
        justify-content: center;
        align-items: center;
        transition: all 0.4s ease;
        position: relative;
        box-shadow: 0 0 0 0 rgb(255, 255, 255);
        overflow: hidden;
    }

    .label .circle .icon {
        color: #fff;
        width: 20px;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        transition: all 0.4s ease;
    }

    .label .circle .square {
        aspect-ratio: 1;
        width: 15px;
        border-radius: 2px;
        background-color: #fff;
        opacity: 0;
        visibility: hidden;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        transition: all 0.4s ease;
    }

    .label .circle::before {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        background-color: #007bff;
        width: 100%;
        height: 0;
        transition: all 0.4s ease;
    }

    .label:has(.input:checked) {
        width: 57px;
        animation: installed 0.4s ease 3.5s forwards;
    }

    .label:has(.input:checked)::before {
        animation: rotate 3s ease-in-out 0.4s forwards;
    }

    .label .input:checked+.circle {
        animation: pulse 1s forwards, circleDelete 0.2s ease 3.5s forwards;
        rotate: 180deg;
    }

    .label .input:checked+.circle::before {
        animation: installing 3s ease-in-out forwards;
    }

    .label .input:checked+.circle .icon {
        opacity: 0;
        visibility: hidden;
    }

    .label .input:checked~.circle .square {
        opacity: 1;
        visibility: visible;
    }

    .label .input:checked~.title {
        opacity: 0;
        visibility: hidden;
    }

    .label .input:checked~.title:last-child {
        animation: showInstalledMessage 0.4s ease 3.5s forwards;
    }

    @keyframes pulse {
        0% {
            scale: 0.95;
            box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.7);
        }

        70% {
            scale: 1;
            box-shadow: 0 0 0 16px rgba(255, 255, 255, 0);
        }

        100% {
            scale: 0.95;
            box-shadow: 0 0 0 0 rgba(255, 255, 255, 0);
        }
    }

    @keyframes installing {
        from {
            height: 0;
        }

        to {
            height: 100%;
        }
    }

    @keyframes rotate {
        0% {
            transform: rotate(-90deg) translate(27px) rotate(0);
            opacity: 1;
            visibility: visible;
        }

        99% {
            transform: rotate(270deg) translate(27px) rotate(270deg);
            opacity: 1;
            visibility: visible;
        }

        100% {
            opacity: 0;
            visibility: hidden;
        }
    }

    @keyframes installed {
        100% {
            width: 150px;
            border-color: rgb(35, 174, 35);
            padding: 2.5px;
        }
    }

    @keyframes circleDelete {
        100% {
            opacity: 0;
            visibility: hidden;
        }
    }

    @keyframes showInstalledMessage {
        100% {
            opacity: 1;
            visibility: visible;
            right: 56px;
        }
    }
</style>
{% endblock %}

{% block body %}
<h1>JEE Advanced Previous Year Papers</h1>

<div id="main-container"></div>
<script>
    // const years = [2024, 2023, 2022, 2021, 2020, 2019, 2018, 2017, 2016, 2015, 2014, 2013, 2012, 2011, 2010, 2009, 2008, 2007];
    // const container = document.getElementById("main-container");

    // years.forEach(year => {
    //     const yearBox = document.createElement("div");
    //     yearBox.className = "year-container";

    //     const header = document.createElement("div");
    //     header.className = "year-header";
    //     header.innerHTML = `<span>JEE Advanced ${year}</span><span class="arrow">▶</span>`;

    //     const papers = document.createElement("div");
    //     papers.className = "papers";



    //     ["Paper 1", "Paper 2"].forEach(paperName => {
    //         const paper = document.createElement("div");
    //         paper.className = "paper";

    //         const toggle = document.createElement("div");
    //         toggle.className = "toggle";
    //         toggle.textContent = paperName;

    //         const options = document.createElement("div");
    //         options.className = "options";

    //         // Create a row for buttons
    //         const buttonRow = document.createElement("div");
    //         buttonRow.style.display = "flex";
    //         buttonRow.style.alignItems = "center";
    //         buttonRow.style.gap = "10px";
    //         buttonRow.style.flexWrap = "wrap";

    //         // DOWNLOAD button (animated)
    //         const label = document.createElement("label");
    //         label.className = "label";
    //         label.innerHTML = `
    //             <input type="checkbox" class="input" />
    //             <span class="circle">
    //                 <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
    //                     <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
    //                         d="M12 19V5m0 14-4-4m4 4 4-4" />
    //                 </svg>
    //                 <div class="square"></div>
    //             </span>
    //             <p class="title">Download</p>
    //             <p class="title">Open</p>
    //         `;

    //         // Handle actual download on click
    //         label.querySelector(".input").addEventListener("change", function () {
    //             if (this.checked) {
    //                 const paperNumber = paperName.endsWith("1") ? "1" : "2";
    //                 const downloadLink = document.createElement("a");
    //                 downloadLink.href = `/static/media/advance/${year}/paper-${paperNumber}.pdf`;
    //                 downloadLink.download = `JEE-ADV-${year}-Paper-${paperNumber}.pdf`;
    //                 document.body.appendChild(downloadLink);
    //                 downloadLink.click();
    //                 document.body.removeChild(downloadLink);
    //             }
    //         });
    //         label.querySelector(".input").addEventListener("change", function () {
    //             const checkbox = this;
    //             const paperNumber = paperName.endsWith("1") ? "1" : "2";
    //             const fileUrl = `/static/media/advance/${year}/paper-${paperNumber}.pdf`;

    //             if (checkbox.checked) {
    //                 // Trigger file download
    //                 const downloadLink = document.createElement("a");
    //                 downloadLink.href = fileUrl;
    //                 downloadLink.download = `JEE-ADV-${year}-Paper-${paperNumber}.pdf`;
    //                 document.body.appendChild(downloadLink);
    //                 downloadLink.click();
    //                 document.body.removeChild(downloadLink);

    //                 // Wait for animation to finish, then enable "Open" behavior
    //                 setTimeout(() => {
    //                     const label = checkbox.closest(".label");
    //                     const openTitle = label.querySelector(".title:last-child");

    //                     // Add click listener to open file
    //                     openTitle.style.cursor = "pointer";
    //                     openTitle.addEventListener("click", () => {
    //                         window.open(fileUrl, "_blank");
    //                     });
    //                 }, 3500); // Match the animation delay
    //             }
    //         });


    //         // TEST button
    //         const testBtn = document.createElement("a");
    //         testBtn.className = "button";
    //         testBtn.href = `/test/${year}/${paperName.toLowerCase().replace(" ", "-")}`;
    //         testBtn.textContent = "Give as a Test";

    //         // Add both to the row
    //         buttonRow.appendChild(label);
    //         buttonRow.appendChild(testBtn);

    //         // Add everything to DOM
    //         options.appendChild(buttonRow);
    //         paper.appendChild(toggle);
    //         paper.appendChild(options);
    //         papers.appendChild(paper);

    //         toggle.addEventListener("click", () => {
    //             options.style.display = options.style.display === "block" ? "none" : "block";
    //         });
    //     });

    //     header.addEventListener("click", () => {
    //         papers.style.display = papers.style.display === "block" ? "none" : "block";
    //         const arrow = header.querySelector(".arrow");
    //         arrow.classList.toggle("rotate", papers.style.display === "block");
    //     });

    //     yearBox.appendChild(header);
    //     yearBox.appendChild(papers);
    //     container.appendChild(yearBox);
    // });
    const years = [2024, 2023, 2022, 2021, 2020, 2019, 2018, 2017, 2016, 2015, 2014, 2013, 2012, 2011, 2010, 2009, 2008, 2007];
    const container = document.getElementById("main-container");

    years.forEach(year => {
        const yearBox = document.createElement("div");
        yearBox.className = "year-container";

        const header = document.createElement("div");
        header.className = "year-header";
        
        header.innerHTML = `<span>JEE Advanced ${year}</span><span class="arrow">▶</span>`;

        const papers = document.createElement("div");
        papers.className = "papers";
        papers.style.display = "flex"; // Show papers by default

        ["Paper 1", "Paper 2"].forEach(paperName => {
            const paper = document.createElement("div");
            paper.className = "paper";

            const toggle = document.createElement("div");
            toggle.className = "toggle";
            toggle.textContent = paperName;

            const options = document.createElement("div");
            options.className = "options";
            // options.style.margin="-5px"
            options.style.display = "none"; // Hidden by default

            // Buttons container
            const buttonRow = document.createElement("div");

            // buttonRow.style.display = "flex";
            // buttonRow.style.alignItems = "center";
            // buttonRow.style.gap = "10px";
            // buttonRow.style.padding="10px"
            // buttonRow.style.flexWrap = "wrap";

            // Download label with animated checkbox
            const label = document.createElement("label");
            label.className = "label";
            label.style.marginBottom="10px";
            label.innerHTML = `
      <input type="checkbox" class="input" />
      <span class="circle">
        <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
            d="M12 19V5m0 14-4-4m4 4 4-4" />
        </svg>
        <div class="square"></div>
      </span>
      <p class="title">Download</p>
      <p class="title open-title" style="cursor: default; user-select:none;">Open</p>
    `;

            const checkbox = label.querySelector(".input");
            const openTitle = label.querySelector(".open-title");
            openTitle.style.pointerEvents = "none"; // Disable open link initially

            const paperNumber = paperName.endsWith("1") ? "1" : "2";
            const fileUrl = `/static/media/advance/${year}/paper-${paperNumber}.pdf`;

            // Handle download checkbox change
            checkbox.addEventListener("change", () => {
                if (checkbox.checked) {
                    // Trigger download
                    const downloadLink = document.createElement("a");
                    downloadLink.href = fileUrl;
                    downloadLink.download = `JEE-ADV-${year}-Paper-${paperNumber}.pdf`;
                    document.body.appendChild(downloadLink);
                    downloadLink.click();
                    document.body.removeChild(downloadLink);

                    // After animation delay enable Open clickable
                    setTimeout(() => {
                        openTitle.style.cursor = "pointer";
                        openTitle.style.userSelect = "auto";
                        openTitle.style.pointerEvents = "auto";

                        // Add click to open PDF in new tab
                        openTitle.addEventListener("click", () => {
                            window.open(fileUrl, "_blank");
                        }, { once: true }); // only once to avoid duplicates
                    }, 3500); // match your animation duration
                } else {
                    // Reset Open button when unchecked
                    openTitle.style.cursor = "default";
                    openTitle.style.userSelect = "none";
                    openTitle.style.pointerEvents = "none";
                    // Remove any attached click event by cloning node (simpler way)
                    const newOpenTitle = openTitle.cloneNode(true);
                    label.replaceChild(newOpenTitle, openTitle);
                }
            });

            // Test button
            const testBtn = document.createElement("a");
            testBtn.className = "button";
            testBtn.href = `/test/${year}/${paperName.toLowerCase().replace(" ", "-")}`;
            testBtn.textContent = "Give as a Test";

            buttonRow.appendChild(label);
            buttonRow.appendChild(testBtn);

            options.appendChild(buttonRow);

            paper.appendChild(toggle);
            paper.appendChild(options);
            papers.appendChild(paper);

            // Toggle options show/hide when clicking paper toggle
            toggle.addEventListener("click", () => {
                options.style.display = options.style.display === "block" ? "none" : "block";
            });
        });

        // Toggle showing all papers under year
        header.addEventListener("click", () => {
            if (papers.style.display === "block") {
                papers.style.display = "none";
                header.querySelector(".arrow").classList.remove("rotate");
            } else {
                papers.style.display = "block";
                header.querySelector(".arrow").classList.add("rotate");
            }
        });

        yearBox.appendChild(header);
        yearBox.appendChild(papers);
        container.appendChild(yearBox);
    });

</script>

{% endblock %}